# Сервис-ориентированная архитектура

## Лабораторная работа № 4

### Задание

Вариант 132459

Переработать сервисы из лабораторной работы #3 следующим образом:
- Второй ("вызывающий") сервис переписать в соответствии с требованиями протокола SOAP.
- Развернуть переработанный сервис на сервере приложений по собственному выбору.
- Оставшийся сервис не модифицировать, не менять его API, протокол и используемый сервер приложений.
- Установить и сконфигурировать на сервере Helios программное обеспечение Mule ESB.
- Настроить интеграцию двух сервисов с использованием установленного программного обеспечения.
- Реализовать дополнительную REST-"прослойку", обеспечивающую возможность доступа к переработанному сервису клиентского приложения без необходимости его модификации. Никакой дополнительной логики, помимо вызовов SOAP-сервиса, разработанная REST-прослойка содержать не должна.

Вопросы к защите лабораторной работы:
1. Протокол SOAP. Особенности, отличия от REST, преимущества и недостатки.
2. Дескрипторы сервисов на SOAP. Формат WSDL.
3. Реестры сервисов. UDDI.
4. Сервисные шины. Назначение, протоколы, особенности работы. Отличия, достоинства и недостатки относительно микросервисной архитектуры и инфраструктурного ПО для неё.
5. Mule ESB. Установка, конфигурация, поддерживаемые протоколы.
6. Реализация взаимодействия веб-сервисов через Mule ESB.


### Комментарии к реализации

Для запуска тестов нужно задать значение переменной окружения `SPRING_PROFILES_ACTIVE` равное `test` - в этом профиле используется БД поднимаемая `testcontainers`

Для запуска в обычном режиме значение переменной окружения `SPRING_PROFILES_ACTIVE` равное `dev`

Файл `.env` должен находится в директории `resources`

Пример `.env` файла находится в `env.example`

Подключение к серверу:
```
ssh s33xxxx@se.ifmo.ru -p 2222
```

Проброс порта для helios:
```
ssh -L 8080:localhost:33xxxx s33xxxx@se.ifmo.ru -p 2222
```

Url подключения к БД
```
jdbc:postgresql://localhost:5432/studs
```

Генерация ключа:
```
keytool -genkeypair -alias spring -keyalg RSA -keysize 4096 \
  -validity 3650 -keystore spring.p12 \
  -storetype PKCS12 -storepass changeit -keypass changeit \
  -dname "CN=localhost, OU=Development, O=Company, L=City, ST=State, C=RU"
```

Экспорт сертификата:
```
keytool -exportcert -alias spring -keystore spring.p12 -storetype PKCS12 -storepass changeit -file spring.crt
```

Добавление сертификата в trustore:
```
keytool -importcert -alias spring -file spring.crt -keystore spring-truststore.p12 -storetype PKCS12 -storepass changeit -noprompt
```

Сбор jar файла с пропуском тестов
```
mvn package -DskipTests
```

Запуск сервисов:
```
SOA_SERVICE_PORT=33511 java -jar soa-0.0.1-SNAPSHOT.jar
```

**Порты которые нужно пробросить:**
- 33510 - обращение на spring
- 33610 - обращение к http-прослойке mule, которая вызывает wildfly

### Ссылки на репозитории лабораторной

1. Ссылка на основной вызываемый сервис реализованный на Spring Boot - https://github.com/stoneshik/fourth-lab-soa
2. Ссылка на второй вызывающий сервис реализованный на SOAP wildfly - https://github.com/stoneshik/fourth-lab-soa-second
3. Ссылка на фронтенд - https://github.com/stoneshik/fourth-lab-soa-frontend
